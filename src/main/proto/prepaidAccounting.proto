syntax = "proto3";

option java_multiple_files = true;
option java_package = "prepaidaccounting";
option java_outer_classname = "PrepaidAccountingProto";

service PrepaidAccounting {
  rpc GetBalance (GetBalanceRequest) returns (BalanceResponse);
  rpc updateBalanceThroughJdbcCache(Deltas) returns (UpdateResponse);
  rpc deletePackageAccount(DeletePackageRequest) returns (DeletePackageResponse);
  
  // PackageAccountReserve operations
  rpc reserveBalance(ReserveRequest) returns (ReserveResponse);
  rpc releaseReserve(ReleaseReserveRequest) returns (ReleaseReserveResponse);
  rpc getReserve(GetReserveRequest) returns (GetReserveResponse);
  rpc deleteReserve(DeleteReserveRequest) returns (DeleteReserveResponse);
  
//  rpc insertPackageAccount(InsertPackageRequest) returns (InsertPackageResponse);
}

message Delta {
  string dbName = 1;
  int64 idPackageAcc = 2;
  double amount = 3;
}

message Deltas {
  repeated Delta deltas = 1;
}

message UpdateResponse {
  bool success = 1;
  string message = 2;
}

message GetBalanceRequest {
  string dbName = 1;
  int64 idPackageAcc = 2;
}

message BalanceResponse {
  bool status = 1;
  double balance = 2;
  string message = 3;
}

message DeletePackageRequest {
  string dbName = 1;
  int64 idPackageAcc = 2;
}

message DeletePackageResponse {
  bool success = 1;
  string message = 2;
}

// PackageAccountReserve messages
message ReserveRequest {
  string dbName = 1;
  int64 idPackageAccount = 2;
  string sessionId = 3;
  double amount = 4;
}

message ReserveResponse {
  bool success = 1;
  string message = 2;
  int64 reserveId = 3;
}

message ReleaseReserveRequest {
  string dbName = 1;
  int64 reserveId = 2;
  double amount = 3;
  string sessionId = 4;
}

message ReleaseReserveResponse {
  bool success = 1;
  string message = 2;
  double remainingReserve = 3;
}

message GetReserveRequest {
  string dbName = 1;
  int64 reserveId = 2;
}

message GetReserveResponse {
  bool success = 1;
  int64 reserveId = 2;
  int64 packageAccountId = 3;
  string sessionId = 4;
  double currentReserve = 5;
  string status = 6;
  string message = 7;
}

message DeleteReserveRequest {
  string dbName = 1;
  int64 reserveId = 2;
}

message DeleteReserveResponse {
  bool success = 1;
  string message = 2;
}

//message PackageAccount {
//  int64 id = 1;
//  int64 packagePurchaseId = 2;
//  string name = 3;
//  string lastAmount = 4;
//  string balanceBefore = 5;
//  string balanceAfter = 6;
//  string uom = 7;
//  bool isSelected = 8;
//}

//message InsertPackageRequest {
//  string dbName = 1;
//  PackageAccount pkgAcc = 2;
//}
//
//message InsertPackageResponse {
//  bool success = 1;
//  string message = 2;
//}






